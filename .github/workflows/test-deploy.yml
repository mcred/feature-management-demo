name: Deploy Testing Database Changes

on:
  push:
  workflow_dispatch:

jobs:
  deploy-database-changes:
    runs-on: ubuntu-latest
    container:
      image: liquibase/liquibase:latest
      env:
        LIQUIBASE_PRO_LICENSE_KEY:  ${{ secrets.PRO_KEY }}
        LIQUIBASE_LAUNCH_DARKLY_SDK_KEY: ${{ secrets.LAUNCHDARKLY_SDK_KEY }}
        LIQUIBASE_COMMAND_URL:  ${{ secrets.DEMO_TEST_URL }}
        LIQUIBASE_COMMAND_USERNAME:  ${{ secrets.DEMO_TEST_USERNAME }}
        LIQUIBASE_COMMAND_PASSWORD:  ${{ secrets.DEMO_TEST_PASSWORD }}
        LIQUIBASE_COMMAND_CHANGELOG_FILE: "changelogs/changes.yml"
        LIQUIBASE_COMMAND_DRIVER: "org.postgresql.Driver"
    steps:
      - name: Checkout Project
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: lpm update && lpm add launchdarkly

      - name: Validate
        run: liquibase validate --log-level info
